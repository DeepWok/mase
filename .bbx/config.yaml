# Define a runner that will be used to run a job
runners:
  ubuntu-runner:
    image: deepwok/mase-docker:latest

# Define a job to be performed during a workflow
jobs:
  choose-commit:
    runner: ubuntu-runner
    steps:
      - run:
          name: Define diff commit
          command: | 
            DIFF_COMMIT_NAME="HEAD^"

  chop-regression:
    runner: ubuntu-runner
    resource_spec: large
    node_selector:
      kubernetes.io/hostname: ee-kraken
    steps:
      - run:
          name: Run software regression
          command: |
            bash scripts/test-machop.sh

  hw-regression:
    runner: ubuntu-runner
    node_selector:
      kubernetes.io/hostname: ee-kraken
    steps:
      - run:
          name: Run hardware regression
          command: |
            export PYTHONPATH="$PATH:$(pwd):$(pwd)/machop"
            echo PYTHONPATH
            echo $PYTHONPATH
            python3 scripts/test-hardware.py -a

  hw-build:
    runner: ubuntu-runner
    volumes:
      - mount:
        name: vivado
        path: /mnt/applications/Xilinx/
    node_selector:
      kubernetes.io/hostname: ee-kraken
    steps:
      - run:
          name: Run hardware regression
          command: |
            export PYTHONPATH="$PATH:$(pwd):$(pwd)/machop"
            echo PYTHONPATH
            echo $PYTHONPATH
            python3 scripts/build-mase-components.py


# Define a workflow to orchestrate a job
workflows:
  mase-chop-regression:
    triggers:
      - pull_request
    jobs:
      - chop-regression

  mase-hw-regression:
    triggers:
      - pull_request
    jobs:
      - hw-regression
